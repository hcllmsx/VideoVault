<div class="video-wrapper">
    <div class="video-container">
        <% if (!video.cover.startsWith('http')) { %>
            <!-- 默认封面使用动态图片 -->
            <div id="coverContainer" class="default-cover" style="position: relative; width: 100%; cursor: pointer;">
                <img id="animatedCover" src="<%= video.cover %>" alt="Video Cover" style="width: 100%; height: auto; display: block;">
                <div class="play-button" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); border-radius: 50%; padding: 20px; transition: transform 0.3s ease;">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="#ffffff">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </div>
            </div>
        <% } %>
        <video id="videoPlayer" controls controlsList="nodownload" oncontextmenu="return false;" draggable="false" 
            <% if (video.cover.startsWith('http')) { %>poster="<%= video.cover %>"<% } else { %>style="display: none;"<% } %>>
            <source src="<%= video.signedUrl %>" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>

<div class="video-content">
    <h1><%= video.title %></h1>
    <p><%= video.description %></p>
</div>

<style>
#coverContainer {
    background-color: #000;
}

.play-button {
    transition: transform 0.3s ease;
}

.play-button:hover {
    transform: translate(-50%, -50%) scale(1.1) !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const coverContainer = document.getElementById('coverContainer');
    const videoPlayer = document.getElementById('videoPlayer');

    if (coverContainer) {
        coverContainer.addEventListener('click', function() {
            coverContainer.style.display = 'none';
            videoPlayer.style.display = 'block';
            videoPlayer.play();
        });
    }

    const video = document.getElementById('videoPlayer');
    
    function adjustVideoSize() {
        if (!video.videoWidth || !video.videoHeight) return;
        
        const maxWidth = Math.min(1280, window.innerWidth);
        const maxHeight = 720;
        const videoRatio = video.videoWidth / video.videoHeight;
        
        let width = video.videoWidth;
        let height = video.videoHeight;
        
        if (width > maxWidth) {
            width = maxWidth;
            height = width / videoRatio;
        }
        
        if (height > maxHeight) {
            height = maxHeight;
            width = height * videoRatio;
        }
        
        video.style.width = '100%';
        video.style.maxWidth = `${width}px`;
        video.style.height = 'auto';
    }

    video.addEventListener('loadedmetadata', adjustVideoSize);
    window.addEventListener('resize', adjustVideoSize);
    
    if (video.readyState >= 1) adjustVideoSize();

    // 如果视频播放结束且使用的是默认封面，显示动态封面
    videoPlayer.addEventListener('ended', function() {
        if (coverContainer) {
            videoPlayer.style.display = 'none';
            coverContainer.style.display = 'block';
        }
    });
});
</script>